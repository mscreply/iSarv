@page
@using System.Globalization
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model iSarv.Areas.User.Pages.Dashboard

@{
    ViewData["Title"] = Localizer.Text("Dashboard");
    var lang = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;
    var user = await UserManager.GetUserIncludeTestPackagesAsync(User);
}

<main>
    <div class="container-fluid p-0">

        <div class="mb-3">
            <h1 class="h3 d-inline align-middle">@Localizer.TextIgnoreCase("Profile")</h1>
        </div>
        <div class="row">
            <div class="col-md-4 col-xl-3">
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">@Localizer.TextIgnoreCase("Profile Details")</h5>
                    </div>
                    <div class="card-body text-center">
                        <img src="/img/avatars/@(user.Id).png" alt="@Localizer.Text("Avatar")"
                             class="img-fluid rounded-circle mb-2" width="128" height="128"
                             onerror="this.src='/img/avatars/0.png'">
                        <h5 class="card-title mb-0">@user.FullName</h5>
                        <div class="text-muted mb-2">@user.Occupation</div>
                        <div class="text-muted mb-2">@user.NationalId</div>

                        <div>
                            <a class="btn btn-primary btn-sm" href="#">@Localizer.TextIgnoreCase("Follow")</a>
                            <a class="btn btn-primary btn-sm" href="#">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round" class="feather feather-message-square">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                @Localizer.TextIgnoreCase("Message")
                            </a>
                        </div>
                    </div>
                    <hr class="my-0">
                    <div class="card-body">
                        <h5 class="h6 card-title">@Localizer.TextIgnoreCase("About")</h5>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round" class="feather feather-home feather-sm me-1">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                                @Localizer.TextIgnoreCase("Lives in") <a href="#">@user.Address</a>
                            </li>
                            <li class="mb-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round" class="feather feather-briefcase feather-sm me-1">
                                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                                </svg>
                                @Localizer.TextIgnoreCase("Study at") <a href="#">@user.University</a>
                            </li>
                            <li class="mb-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round" class="feather feather-map-pin feather-sm me-1">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                                @Localizer.TextIgnoreCase("Field of Study") <a href="#">@user.FieldOfStudy</a>
                            </li>
                            <li class="mb-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round" class="feather feather-phone feather-sm me-1">
                                    <path d="M22 16.92V21a2 2 0 0 1-2.18 2A19.86 19.86 0 0 1 3 5.18 2 2 0 0 1 5 3h4.09a2 2 0 0 1 2 1.72 12.05 12.05 0 0 0 .57 2.57 2 2 0 0 1-.45 2L9.91 10.09a16 16 0 0 0 6 6l1.8-1.8a2 2 0 0 1 2-.45 12.05 12.05 0 0 0 2.57.57 2 2 0 0 1 1.72 2z"></path>
                                </svg>
                                @Localizer.TextIgnoreCase("Phone Number") <a href="tel:@user.PhoneNumber">@user.PhoneNumber</a>
                            </li>
                        </ul>
                    </div>
                    <hr class="my-0">
                    <div class="card-body">
                        <h5 class="h6 card-title">@Localizer.TextIgnoreCase("Bio")</h5>
                        <div>@user.Bio</div>
                    </div>
                </div>
            </div>

            <div class="col-md-8 col-xl-9">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">@Localizer.TextIgnoreCase("Packages")</h5>
                    </div>
                    <div class="card-body h-100">
                        <div class="card-body h-100">
                            <div class="row">
                                @foreach (var package in user.TestPackages)
                                {
                                    <div class="col-md-4">
                                        <div class="card mb-3">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">@Localizer.TextIgnoreCase(package.Name)</h5>
                                            </div>
                                            <img src="/img/icon/packages.jpg" alt="@package.Name" class="card-img-top">
                                            <div class="card-body">
                                                <div class="card-body">
                                                    <p class="card-text">
                                                        @Localizer.TextIgnoreCase("Neo Test") -
                                                        @if (package.NeoTest.IsCompleted)
                                                        {
                                                            <span>@Localizer.TextIgnoreCase("Completed")
                                                                <a href="/Test/Neo/Result/@package.Id"
                                                                   data-bs-toggle="tooltip"
                                                                   title="@Localizer.TextIgnoreCase("Click to view the result.")">
                                                                    <i class="fas fa-eye"></i>
                                                                </a>
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            @if (package.NeoTest.StartDate > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Start Date") : @package.NeoTest.StartDate.ToShortCultureDate(lang)</span>
                                                            }
                                                            else if (package.NeoTest.Deadline > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Deadline") : @package.NeoTest.Deadline.ToShortCultureDate(lang)</span>
                                                                <a href="/Test/Neo/TakeTest/@package.Id"
                                                                   data-bs-toggle="tooltip"
                                                                   title="@Localizer.TextIgnoreCase("Click to take the test")">
                                                                    <i class="fas fa-play"></i>
                                                                </a>
                                                            }
                                                            else
                                                            {
                                                                <span>@Localizer.Text("Expired")</span>
                                                            }
                                                        }
                                                    </p>
                                                    <p class="card-text">
                                                        @Localizer.TextIgnoreCase("Clifton Test") -
                                                        @if (package.CliftonTest.IsCompleted)
                                                        {
                                                            <span>@Localizer.TextIgnoreCase("Completed")
                                                                <a href="/Test/Clifton/Result/@package.Id"><i
                                                                        class="fas fa-check-circle"></i></a>
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            @if (package.CliftonTest.StartDate > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Start Date") : @package.CliftonTest.StartDate.ToShortCultureDate(lang)</span>
                                                            }
                                                            else if (package.CliftonTest.Deadline > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Deadline") : @package.CliftonTest.Deadline.ToShortCultureDate(lang)</span>
                                                                <a href="/Test/Clifton/TakeTest/@package.Id"
                                                                   class="btn btn-sm btn-primary"
                                                                   data-bs-toggle="tooltip"
                                                                   title="@Localizer.TextIgnoreCase("Click to take the test")">
                                                                    <i class="fas fa-play"></i>
                                                                </a>
                                                            }
                                                            else
                                                            {
                                                                <span>@Localizer.Text("Expired")</span>
                                                            }
                                                        }
                                                    </p>
                                                    <p class="card-text">
                                                        @Localizer.TextIgnoreCase("Hollands Test") -
                                                        @if (package.HollandsTest.IsCompleted)
                                                        {
                                                            <span>@Localizer.TextIgnoreCase("Completed")
                                                                <a href="/Test/Hollands/Result/@package.Id"><i
                                                                        class="fas fa-check-circle"></i></a>
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            @if (package.HollandsTest.StartDate > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Start Date") : @package.HollandsTest.StartDate.ToShortCultureDate(lang)</span>
                                                            }
                                                            else if (package.HollandsTest.Deadline > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Deadline") : @package.HollandsTest.Deadline.ToShortCultureDate(lang)</span>
                                                                <a href="/Test/Hollands/TakeTest/@package.Id"
                                                                   class="btn btn-sm btn-primary"
                                                                   data-bs-toggle="tooltip"
                                                                   title="@Localizer.TextIgnoreCase("Click to take the test")">
                                                                    <i class="fas fa-play"></i>
                                                                </a>
                                                            }
                                                            else
                                                            {
                                                                <span>@Localizer.Text("Expired")</span>
                                                            }
                                                        }
                                                    </p>
                                                    <p class="card-text">
                                                        @Localizer.TextIgnoreCase("Ravens Test") -
                                                        @if (package.RavensTest.IsCompleted)
                                                        {
                                                            <span>@Localizer.TextIgnoreCase("Completed")
                                                                <a href="/Test/Ravens/Result/@package.Id"><i
                                                                        class="fas fa-check-circle"></i></a>
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            @if (package.RavensTest.StartDate > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Start Date") : @package.RavensTest.StartDate.ToShortCultureDate(lang)</span>
                                                            }
                                                            else if (package.RavensTest.Deadline > DateTime.Now)
                                                            {
                                                                <span>@Localizer.Text("Deadline") : @package.RavensTest.Deadline.ToShortCultureDate(lang)</span>
                                                                <a href="/Test/Ravens/TakeTest/@package.Id"
                                                                   class="btn btn-sm btn-primary"
                                                                   data-bs-toggle="tooltip"
                                                                   title="@Localizer.TextIgnoreCase("Click to take the test")">
                                                                    <i class="fas fa-play"></i>
                                                                </a>
                                                            }
                                                            else
                                                            {
                                                                <span>@Localizer.Text("Expired")</span>
                                                            }
                                                        }
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="card-footer text-center">
                                                @if (package.IsCompleted)
                                                {
                                                    <a href="/Packages/Result/@package.Id" class="btn btn-success">
                                                        @Localizer.TextIgnoreCase("See Result")
                                                    </a>
                                                }
                                                else if (package.StartDate <= DateTime.Now && package.Deadline >= DateTime.Now)
                                                {
                                                    <span
                                                        class="text-warning">@Localizer.TextIgnoreCase("In Progress")</span>
                                                }
                                                else
                                                {
                                                    <span
                                                        class="text-danger">@Localizer.TextIgnoreCase("Not Started or Expired")</span>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                }
                                <div class="col-md-4">
                                    <div class="card border-success mb-3">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">@Localizer.TextIgnoreCase("Buy Package")</h5>
                                        </div>
                                        <img src="/img/icon/buy packages.jpg" alt="Package" class="card-img-top">
                                        <div class="card-body text-center">
                                            <a href="/Packages/Buy" class="btn btn-success">
                                                @Localizer.TextIgnoreCase("Buy New Package") <!-- To be done -->
                                            </a>
                                            <a asp-area="Package" asp-page="Activation" class="btn btn-primary">
                                                @Localizer.TextIgnoreCase("Activate by Code")
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">@Localizer.TextIgnoreCase("Activities")</h5>
                        </div>
                        <div class="card-body h-100">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
